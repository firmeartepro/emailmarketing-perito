<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Email Marketing - Mois√©s Perito</title>
    <script src="https://cdn.emailjs.com/dist/email.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 1.1em;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.3s ease;
        }

        .tab.active {
            background: white;
            color: #2c3e50;
            border-bottom: 3px solid #667eea;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab-content {
            display: none;
            padding: 40px;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s ease;
            margin: 10px 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
            color: #2c3e50;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            border-left: 5px solid #667eea;
        }

        .stat-card h3 {
            font-size: 2.5em;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .stat-card p {
            color: #6c757d;
            font-weight: 600;
        }

        .email-template {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            border-left: 5px solid #28a745;
        }

        .template-preview {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 15px;
            border: 1px solid #dee2e6;
        }

        .contact-list {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            max-height: 300px;
            overflow-y: auto;
        }

        .contact-item {
            padding: 15px;
            border-bottom: 1px solid #f8f9fa;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .contact-item:last-child {
            border-bottom: none;
        }

        .contact-item:hover {
            background: #f8f9fa;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            width: 0%;
            transition: width 0.3s ease;
        }

        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .container {
                margin: 10px;
                border-radius: 10px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .tab-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìß Sistema de Email Marketing</h1>
            <p>Ferramenta Profissional para Mois√©s - Perito Grafot√©cnico</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('dashboard')">üìä Dashboard</button>
            <button class="tab" onclick="showTab('contacts')">üë• Contatos</button>
            <button class="tab" onclick="showTab('templates')">üé® Templates</button>
            <button class="tab" onclick="showTab('campaigns')">üì§ Campanhas</button>
            <button class="tab" onclick="showTab('settings')">‚öôÔ∏è Configura√ß√µes</button>
        </div>

        <!-- Dashboard -->
        <div class="tab-content active" id="dashboard">
            <h2>üìä Dashboard - Vis√£o Geral</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <h3 id="totalContacts">0</h3>
                    <p>üë• Total de Contatos</p>
                </div>
                <div class="stat-card">
                    <h3 id="sentThisMonth">0</h3>
                    <p>üìß Emails Enviados (M√™s)</p>
                </div>
                <div class="stat-card">
                    <h3 id="templatesCount">2</h3>
                    <p>üé® Templates Dispon√≠veis</p>
                </div>
                <div class="stat-card">
                    <h3 id="campaignsCount">0</h3>
                    <p>üì§ Campanhas Ativas</p>
                </div>
            </div>

            <div class="alert alert-success">
                <strong>‚úÖ Sistema Operacional!</strong> Tudo funcionando perfeitamente. Pronto para enviar campanhas profissionais.
            </div>

            <div class="form-group">
                <button class="btn btn-success" onclick="testEmailSystem()">üß™ Testar Sistema de Email</button>
                <button class="btn btn-warning" onclick="showTab('settings')">‚öôÔ∏è Configurar EmailJS</button>
            </div>
        </div>

        <!-- Contatos -->
        <div class="tab-content" id="contacts">
            <h2>üë• Gerenciar Contatos</h2>
            
            <div class="form-group">
                <label for="contactName">Nome do Contato</label>
                <input type="text" id="contactName" placeholder="Ex: Jo√£o Silva">
            </div>
            
            <div class="form-group">
                <label for="contactEmail">Email</label>
                <input type="email" id="contactEmail" placeholder="Ex: joao@email.com">
            </div>
            
            <div class="form-group">
                <label for="contactCategory">Categoria</label>
                <select id="contactCategory">
                    <option value="cliente">Cliente</option>
                    <option value="prospect">Prospect</option>
                    <option value="parceiro">Parceiro</option>
                    <option value="advogado">Advogado</option>
                </select>
            </div>
            
            <button class="btn btn-success" onclick="addContact()">‚ûï Adicionar Contato</button>
            <button class="btn btn-warning" onclick="importContacts()">üì• Importar Lista</button>
            
            <h3 style="margin-top: 30px;">üìã Lista de Contatos</h3>
            <div class="contact-list" id="contactList">
                <div class="contact-item">
                    <div>
                        <strong>Exemplo - Jo√£o Silva</strong><br>
                        <small>joao@email.com | Cliente</small>
                    </div>
                    <button class="btn btn-danger" style="padding: 5px 10px; font-size: 0.9em;">üóëÔ∏è</button>
                </div>
            </div>
        </div>

        <!-- Templates -->
        <div class="tab-content" id="templates">
            <h2>üé® Templates de Email</h2>
            
            <div class="email-template">
                <h3>üìã Template: Consultoria Gratuita - Mois√©s</h3>
                <div class="template-preview" id="template1">
                    <strong>Assunto:</strong> üîç Descubra se Seus Documentos S√£o Aut√™nticos - An√°lise GRATUITA com Mois√©s!
                    <br><br>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
                        <p><strong>Ol√° [NOME],</strong></p>
                        <p>Sou <strong>Mois√©s, Perito Grafot√©cnico</strong>, e voc√™ sabia que <strong>73% dos documentos questionados</strong> apresentam algum tipo de irregularidade?</p>
                        <p>Como especialista em Grafoscopia, posso ajudar voc√™ a descobrir a verdade sobre qualquer documento suspeito.</p>
                        <p><strong>üéÅ OFERTA ESPECIAL:</strong> An√°lise grafot√©cnica GRATUITA para novos clientes!</p>
                        <div style="text-align: center; margin: 20px 0;">
                            <a href="#" style="background: #28a745; color: white; padding: 15px 30px; text-decoration: none; border-radius: 8px; font-weight: bold;">
                                ‚úÖ QUERO MINHA AN√ÅLISE GRATUITA
                            </a>
                        </div>
                        <p><strong>Contato direto:</strong><br>
                        üìß moises.peritografotecnico@gmail.com<br>
                        üì± WhatsApp: (XX) XXXXX-XXXX</p>
                        <p><small>Esta oferta √© v√°lida apenas por tempo limitado!</small></p>
                    </div>
                </div>
            </div>
            
            <div class="email-template">
                <h3>üíº Template: Contrata√ß√£o Profissional - Mois√©s</h3>
                <div class="template-preview" id="template2">
                    <strong>Assunto:</strong> ‚öñÔ∏è Precisa de Per√≠cia Grafot√©cnica Oficial? Perito Mois√©s Dispon√≠vel
                    <br><br>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
                        <p><strong>Prezado(a) [NOME],</strong></p>
                        <p>Quando a <strong>autenticidade de documentos</strong> est√° em quest√£o, voc√™ precisa de um especialista confi√°vel.</p>
                        <p><strong>Mois√©s - Perito Grafot√©cnico:</strong><br>
                        ‚úÖ Perito Assistente T√©cnico Certificado<br>
                        ‚úÖ Laudos aceitos em tribunais<br>
                        ‚úÖ Mais de 500 casos analisados<br>
                        ‚úÖ Relat√≥rios t√©cnicos detalhados</p>
                        <div style="text-align: center; margin: 20px 0;">
                            <a href="#" style="background: #dc3545; color: white; padding: 15px 30px; text-decoration: none; border-radius: 8px; font-weight: bold;">
                                üéØ CONTRATAR PERITO MOIS√âS
                            </a>
                        </div>
                        <p><strong>Contato:</strong> moises.peritografotecnico@gmail.com</p>
                        <p><strong>Urg√™ncia?</strong> Atendimento em 24h para casos emergenciais.</p>
                    </div>
                </div>
            </div>
            
            <button class="btn" onclick="generateNewTemplate()">ü§ñ Gerar Novo Template com IA</button>
        </div>

        <!-- Campanhas -->
        <div class="tab-content" id="campaigns">
            <h2>üì§ Criar e Enviar Campanhas</h2>
            
            <div class="form-group">
                <label for="campaignName">Nome da Campanha</label>
                <input type="text" id="campaignName" placeholder="Ex: Promo√ß√£o An√°lise Gratuita - Janeiro 2024">
            </div>
            
            <div class="form-group">
                <label for="campaignTemplate">Selecionar Template</label>
                <select id="campaignTemplate">
                    <option value="template1">üìã Consultoria Gratuita - Mois√©s</option>
                    <option value="template2">üíº Contrata√ß√£o Profissional - Mois√©s</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="campaignAudience">P√∫blico-Alvo</label>
                <select id="campaignAudience">
                    <option value="all">Todos os Contatos</option>
                    <option value="cliente">Apenas Clientes</option>
                    <option value="prospect">Apenas Prospects</option>
                    <option value="parceiro">Apenas Parceiros</option>
                    <option value="advogado">Apenas Advogados</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="sendFrequency">Frequ√™ncia de Envio</label>
                <select id="sendFrequency">
                    <option value="daily">Di√°rio</option>
                    <option value="weekly">Semanal</option>
                    <option value="biweekly">Quinzenal</option>
                    <option value="monthly">Mensal</option>
                </select>
            </div>
            
            <div class="form-group">
                <button class="btn btn-success" onclick="sendCampaign()">üöÄ Enviar Campanha Agora</button>
                <button class="btn btn-warning" onclick="scheduleCampaign()">‚è∞ Agendar Envio</button>
                <button class="btn" onclick="previewCampaign()">üëÅÔ∏è Visualizar</button>
            </div>
            
            <div class="loading" id="campaignLoading">
                <div class="loading-spinner"></div>
                <p>Enviando campanha... Por favor, aguarde.</p>
                <div class="progress-bar">
                    <div class="progress-fill" id="campaignProgress"></div>
                </div>
            </div>
        </div>

        <!-- Configura√ß√µes -->
        <div class="tab-content" id="settings">
            <h2>‚öôÔ∏è Configura√ß√µes do Sistema</h2>
            
            <div class="alert alert-warning">
                <strong>üîß Configura√ß√£o Necess√°ria:</strong> Para enviar emails reais, configure suas credenciais do EmailJS abaixo.
            </div>
            
            <div class="form-group">
                <label for="emailjsUserId">EmailJS User ID</label>
                <input type="text" id="emailjsUserId" placeholder="Seu User ID do EmailJS">
            </div>
            
            <div class="form-group">
                <label for="emailjsServiceId">Service ID</label>
                <input type="text" id="emailjsServiceId" placeholder="Seu Service ID">
            </div>
            
            <div class="form-group">
                <label for="emailjsTemplateId">Template ID</label>
                <input type="text" id="emailjsTemplateId" placeholder="Seu Template ID">
            </div>
            
            <div class="form-group">
                <label for="senderName">Nome do Remetente</label>
                <input type="text" id="senderName" placeholder="Mois√©s - Perito Grafot√©cnico" value="Mois√©s - Perito Grafot√©cnico">
            </div>
            
            <div class="form-group">
                <label for="monthlyLimit">Limite Mensal de Emails</label>
                <input type="number" id="monthlyLimit" placeholder="200" value="200">
            </div>
            
            <button class="btn btn-success" onclick="saveEmailJSConfig()">üíæ Salvar Configura√ß√µes</button>
            <button class="btn btn-warning" onclick="testEmailSystem()">üß™ Testar Configura√ß√£o</button>
            
            <div style="margin-top: 30px;">
                <h3>üìä Status do Sistema</h3>
                <div class="stat-card">
                    <p><strong>Status EmailJS:</strong> <span id="emailjsStatus">‚ùå N√£o Configurado</span></p>
                    <p><strong>Emails Restantes:</strong> <span id="emailsRemaining">0</span></p>
                    <p><strong>√öltimo Teste:</strong> <span id="lastTest">Nunca</span></p>
                </div>
            </div>
        </div>
    </div>

    <div class="loading" id="loading">
        <div class="loading-spinner"></div>
        <p>Processando... Por favor, aguarde.</p>
    </div>

    <script>
        // Configura√ß√µes globais
        let emailjsConfig = {
            isConfigured: false,
            userId: '',
            serviceId: '',
            templateId: '',
            senderName: 'Mois√©s - Perito Grafot√©cnico',
            monthlyLimit: 200,
            sentThisMonth: 0
        };

        let contacts = [
            {
                id: 1,
                name: 'Jo√£o Silva',
                email: 'joao@email.com',
                category: 'cliente'
            }
        ];

        let campaigns = [];

        // Inicializar sistema
        document.addEventListener('DOMContentLoaded', function() {
            loadEmailJSConfig();
            updateDashboard();
            updateContactList();
        });

        // Gerenciamento de abas
        function showTab(tabName) {
            // Esconder todas as abas
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(tab => tab.classList.remove('active'));
            
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Mostrar aba selecionada
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Fun√ß√£o para converter HTML em texto limpo e formatado
        function htmlToCleanText(html) {
            // Criar elemento tempor√°rio para processar HTML
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = html;
            
            // Substituir tags HTML por formata√ß√£o de texto
            let text = html;
            
            // Quebras de linha
            text = text.replace(/<br\s*\/?>/gi, '\n');
            text = text.replace(/<\/p>/gi, '\n\n');
            text = text.replace(/<p[^>]*>/gi, '');
            
            // Texto em negrito
            text = text.replace(/<strong[^>]*>(.*?)<\/strong>/gi, '**$1**');
            text = text.replace(/<b[^>]*>(.*?)<\/b>/gi, '**$1**');
            
            // Links
            text = text.replace(/<a[^>]*href="([^"]*)"[^>]*>(.*?)<\/a>/gi, '$2 ($1)');
            
            // Remover divs e spans mantendo conte√∫do
            text = text.replace(/<\/?div[^>]*>/gi, '\n');
            text = text.replace(/<\/?span[^>]*>/gi, '');
            
            // Remover outras tags HTML
            text = text.replace(/<[^>]*>/g, '');
            
            // Decodificar entidades HTML
            const textarea = document.createElement('textarea');
            textarea.innerHTML = text;
            text = textarea.value;
            
            // Limpar espa√ßos extras e quebras de linha
            text = text.replace(/\n\s*\n\s*\n/g, '\n\n'); // Max 2 quebras seguidas
            text = text.replace(/^\s+|\s+$/g, ''); // Remover espa√ßos in√≠cio/fim
            text = text.replace(/[ \t]+/g, ' '); // Normalizar espa√ßos
            
            return text;
        }

        // Configura√ß√µes EmailJS
        function loadEmailJSConfig() {
            const saved = localStorage.getItem('emailjsConfig');
            if (saved) {
                emailjsConfig = JSON.parse(saved);
                
                // Preencher campos
                document.getElementById('emailjsUserId').value = emailjsConfig.userId || '';
                document.getElementById('emailjsServiceId').value = emailjsConfig.serviceId || '';
                document.getElementById('emailjsTemplateId').value = emailjsConfig.templateId || '';
                document.getElementById('senderName').value = emailjsConfig.senderName || 'Mois√©s - Perito Grafot√©cnico';
                document.getElementById('monthlyLimit').value = emailjsConfig.monthlyLimit || 200;
                
                // Verificar se est√° configurado
                if (emailjsConfig.userId && emailjsConfig.serviceId && emailjsConfig.templateId) {
                    emailjsConfig.isConfigured = true;
                    emailjs.init(emailjsConfig.userId);
                    document.getElementById('emailjsStatus').innerHTML = '‚úÖ Configurado';
                }
            }
            
            updateEmailStatus();
        }

        function saveEmailJSConfig() {
            emailjsConfig.userId = document.getElementById('emailjsUserId').value;
            emailjsConfig.serviceId = document.getElementById('emailjsServiceId').value;
            emailjsConfig.templateId = document.getElementById('emailjsTemplateId').value;
            emailjsConfig.senderName = document.getElementById('senderName').value;
            emailjsConfig.monthlyLimit = parseInt(document.getElementById('monthlyLimit').value);
            
            if (emailjsConfig.userId && emailjsConfig.serviceId && emailjsConfig.templateId) {
                emailjsConfig.isConfigured = true;
                emailjs.init(emailjsConfig.userId);
                document.getElementById('emailjsStatus').innerHTML = '‚úÖ Configurado';
                alert('‚úÖ Configura√ß√µes salvas com sucesso!\n\nüîß EmailJS configurado e pronto para uso.');
            } else {
                emailjsConfig.isConfigured = false;
                document.getElementById('emailjsStatus').innerHTML = '‚ùå N√£o Configurado';
                alert('‚ùå Por favor, preencha todos os campos obrigat√≥rios.');
            }
            
            localStorage.setItem('emailjsConfig', JSON.stringify(emailjsConfig));
            updateEmailStatus();
        }

        function updateEmailStatus() {
            document.getElementById('emailsRemaining').textContent = emailjsConfig.monthlyLimit - emailjsConfig.sentThisMonth;
            document.getElementById('sentThisMonth').textContent = emailjsConfig.sentThisMonth;
        }

        // Teste do sistema de email
        async function testEmailSystem() {
            if (!emailjsConfig.isConfigured) {
                alert('‚ùå EmailJS n√£o configurado!\n\nüîß V√° para Configura√ß√µes e preencha suas credenciais do EmailJS primeiro.');
                showTab('settings');
                return;
            }
            
            document.getElementById('loading').style.display = 'block';
            
            try {
                await sendRealEmail(
                    'moises.peritografotecnico@gmail.com',
                    'üß™ Teste do Sistema - Mois√©s Perito',
                    '<p><strong>Ol√° Mois√©s!</strong></p><p>Este √© um email de teste do seu sistema de marketing.</p><p><strong>‚úÖ Sistema funcionando perfeitamente!</strong></p><p>Agora voc√™ pode enviar campanhas profissionais para seus clientes.</p><p><strong>Contato:</strong> moises.peritografotecnico@gmail.com</p>'
                );
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('lastTest').textContent = new Date().toLocaleString('pt-BR');
                alert('‚úÖ Email de teste enviado para moises.peritografotecnico@gmail.com!\n\nüîç IMPORTANTE: Verifique:\n‚Ä¢ Caixa de entrada\n‚Ä¢ Pasta SPAM/Lixo eletr√¥nico\n‚Ä¢ Pasta Promo√ß√µes\n\n‚è∞ Pode demorar 1-3 minutos para chegar.');
                
            } catch (error) {
                document.getElementById('loading').style.display = 'none';
                alert('‚ùå Erro no teste: ' + error.message + '\n\nüîß POSS√çVEIS SOLU√á√ïES:\n‚Ä¢ Verifique se as chaves est√£o corretas\n‚Ä¢ Certifique-se que o template tem os campos: {{subject}}, {{message}}, {{to_email}}, {{from_name}}\n‚Ä¢ Aguarde alguns minutos e tente novamente');
            }
        }
        
        async function sendRealEmail(toEmail, subject, htmlContent) {
            if (!emailjsConfig.isConfigured) {
                throw new Error('EmailJS n√£o configurado');
            }
            
            if (emailjsConfig.sentThisMonth >= emailjsConfig.monthlyLimit) {
                throw new Error('Limite mensal de emails atingido');
            }
            
            try {
                // Converter HTML para texto limpo e formatado
                const cleanTextContent = htmlToCleanText(htmlContent);
                
                const templateParams = {
                    to_email: toEmail,
                    from_name: emailjsConfig.senderName,
                    subject: subject,
                    message: cleanTextContent  // Agora enviando texto limpo ao inv√©s de HTML
                };
                
                console.log('üìß ENVIANDO EMAIL REAL via EmailJS:');
                console.log('Para:', toEmail);
                console.log('Assunto:', subject);
                console.log('De:', emailjsConfig.senderName);
                console.log('Conte√∫do convertido:', cleanTextContent);
                
                const response = await emailjs.send(
                    emailjsConfig.serviceId,
                    emailjsConfig.templateId,
                    templateParams
                );
                
                // Atualizar contador
                emailjsConfig.sentThisMonth++;
                localStorage.setItem('emailjsConfig', JSON.stringify(emailjsConfig));
                
                if (document.getElementById('sentThisMonth')) {
                    document.getElementById('sentThisMonth').textContent = emailjsConfig.sentThisMonth;
                }
                
                updateEmailStatus();
                return response;
                
            } catch (error) {
                console.error('Erro ao enviar email:', error);
                throw error;
            }
        }

        // Gerenciamento de contatos
        function addContact() {
            const name = document.getElementById('contactName').value;
            const email = document.getElementById('contactEmail').value;
            const category = document.getElementById('contactCategory').value;
            
            if (!name || !email) {
                alert('‚ùå Por favor, preencha nome e email.');
                return;
            }
            
            // Validar email
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                alert('‚ùå Por favor, insira um email v√°lido.');
                return;
            }
            
            const newContact = {
                id: Date.now(),
                name: name,
                email: email,
                category: category
            };
            
            contacts.push(newContact);
            
            // Limpar campos
            document.getElementById('contactName').value = '';
            document.getElementById('contactEmail').value = '';
            
            updateContactList();
            updateDashboard();
            
            alert('‚úÖ Contato adicionado com sucesso!');
        }

        function removeContact(id) {
            if (confirm('‚ùì Tem certeza que deseja remover este contato?')) {
                contacts = contacts.filter(contact => contact.id !== id);
                updateContactList();
                updateDashboard();
            }
        }

        function updateContactList() {
            const contactList = document.getElementById('contactList');
            
            if (contacts.length === 0) {
                contactList.innerHTML = '<div class="contact-item"><div><strong>Nenhum contato cadastrado</strong><br><small>Adicione contatos para come√ßar suas campanhas</small></div></div>';
                return;
            }
            
            contactList.innerHTML = contacts.map(contact => `
                <div class="contact-item">
                    <div>
                        <strong>${contact.name}</strong><br>
                        <small>${contact.email} | ${contact.category}</small>
                    </div>
                    <button class="btn btn-danger" style="padding: 5px 10px; font-size: 0.9em;" onclick="removeContact(${contact.id})">üóëÔ∏è</button>
                </div>
            `).join('');
        }

        function importContacts() {
            alert('üöß Funcionalidade em desenvolvimento!\n\nEm breve voc√™ poder√° importar contatos via:\n‚Ä¢ Arquivo CSV\n‚Ä¢ Planilha Excel\n‚Ä¢ Integra√ß√£o com Google Contacts');
        }

        // Campanhas
        function previewCampaign() {
            const templateId = document.getElementById('campaignTemplate').value;
            const templateElement = document.getElementById(templateId);
            
            if (templateElement) {
                const content = templateElement.innerHTML;
                const newWindow = window.open('', '_blank');
                newWindow.document.write(`
                    <html>
                        <head>
                            <title>Preview da Campanha</title>
                            <style>
                                body { font-family: Arial, sans-serif; padding: 20px; }
                                .preview-header { background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
                            </style>
                        </head>
                        <body>
                            <div class="preview-header">
                                <h2>üìß Preview da Campanha</h2>
                                <p><strong>Template:</strong> ${templateId === 'template1' ? 'Consultoria Gratuita' : 'Contrata√ß√£o Profissional'}</p>
                            </div>
                            ${content}
                        </body>
                    </html>
                `);
            }
        }

        async function sendCampaign() {
            const campaignName = document.getElementById('campaignName').value;
            const templateId = document.getElementById('campaignTemplate').value;
            const audience = document.getElementById('campaignAudience').value;
            
            if (!campaignName) {
                alert('‚ùå Por favor, insira um nome para a campanha.');
                return;
            }
            
            if (!emailjsConfig.isConfigured) {
                alert('‚ùå EmailJS n√£o configurado!\n\nüîß V√° para Configura√ß√µes e configure suas credenciais primeiro.');
                showTab('settings');
                return;
            }
            
            // Filtrar contatos por audi√™ncia
            let targetContacts = contacts;
            if (audience !== 'all') {
                targetContacts = contacts.filter(contact => contact.category === audience);
            }
            
            if (targetContacts.length === 0) {
                alert('‚ùå Nenhum contato encontrado para o p√∫blico-alvo selecionado.');
                return;
            }
            
            if (emailjsConfig.sentThisMonth + targetContacts.length > emailjsConfig.monthlyLimit) {
                alert(`‚ùå Limite mensal excedido!\n\nVoc√™ tem ${emailjsConfig.monthlyLimit - emailjsConfig.sentThisMonth} emails restantes este m√™s.\nEsta campanha enviaria ${targetContacts.length} emails.`);
                return;
            }
            
            if (!confirm(`üì§ Confirmar envio da campanha?\n\nüìä Detalhes:\n‚Ä¢ Nome: ${campaignName}\n‚Ä¢ Template: ${templateId === 'template1' ? 'Consultoria Gratuita' : 'Contrata√ß√£o Profissional'}\n‚Ä¢ Destinat√°rios: ${targetContacts.length} contatos\n‚Ä¢ P√∫blico: ${audience === 'all' ? 'Todos' : audience}\n\n‚úÖ Continuar?`)) {
                return;
            }
            
            // Mostrar loading
            document.getElementById('campaignLoading').style.display = 'block';
            const progressBar = document.getElementById('campaignProgress');
            
            try {
                // Obter conte√∫do do template
                const templateElement = document.getElementById(templateId);
                const templateContent = templateElement.innerHTML;
                
                // Extrair assunto do template
                const subjectMatch = templateContent.match(/<strong>Assunto:<\/strong>\s*([^<]+)/);
                const subject = subjectMatch ? subjectMatch[1].trim() : 'Email do Mois√©s - Perito Grafot√©cnico';
                
                let successCount = 0;
                let errorCount = 0;
                
                // Enviar para cada contato
                for (let i = 0; i < targetContacts.length; i++) {
                    const contact = targetContacts[i];
                    
                    try {
                        // Personalizar conte√∫do
                        let personalizedContent = templateContent.replace(/\[NOME\]/g, contact.name);
                        
                        await sendRealEmail(contact.email, subject, personalizedContent);
                        successCount++;
                        
                        // Atualizar progresso
                        const progress = ((i + 1) / targetContacts.length) * 100;
                        progressBar.style.width = progress + '%';
                        
                        // Delay entre envios para evitar spam
                        if (i < targetContacts.length - 1) {
                            await new Promise(resolve => setTimeout(resolve, 2000));
                        }
                        
                    } catch (error) {
                        console.error(`Erro ao enviar para ${contact.email}:`, error);
                        errorCount++;
                    }
                }
                
                // Esconder loading
                document.getElementById('campaignLoading').style.display = 'none';
                
                // Salvar campanha
                const campaign = {
                    id: Date.now(),
                    name: campaignName,
                    template: templateId,
                    audience: audience,
                    sent: successCount,
                    errors: errorCount,
                    date: new Date().toLocaleString('pt-BR')
                };
                
                campaigns.push(campaign);
                updateDashboard();
                
                alert(`‚úÖ Campanha enviada!\n\nüìä Resultados:\n‚Ä¢ Enviados com sucesso: ${successCount}\n‚Ä¢ Erros: ${errorCount}\n‚Ä¢ Total de destinat√°rios: ${targetContacts.length}\n\nüìß Os emails podem demorar alguns minutos para chegar.`);
                
            } catch (error) {
                document.getElementById('campaignLoading').style.display = 'none';
                alert('‚ùå Erro ao enviar campanha: ' + error.message);
            }
        }

        function scheduleCampaign() {
            alert('üöß Funcionalidade em desenvolvimento!\n\nEm breve voc√™ poder√° agendar campanhas para:\n‚Ä¢ Data e hora espec√≠ficas\n‚Ä¢ Envios recorrentes\n‚Ä¢ Automa√ß√£o baseada em eventos');
        }

        // Templates
        function generateNewTemplate() {
            alert('üöß Gerador de Templates com IA em desenvolvimento!\n\nEm breve voc√™ poder√°:\n‚Ä¢ Gerar templates personalizados\n‚Ä¢ Usar IA para otimizar conte√∫do\n‚Ä¢ Criar varia√ß√µes A/B automaticamente');
        }

        // Dashboard
        function updateDashboard() {
            document.getElementById('totalContacts').textContent = contacts.length;
            document.getElementById('sentThisMonth').textContent = emailjsConfig.sentThisMonth;
            document.getElementById('campaignsCount').textContent = campaigns.length;
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'972af5df91bdf202',t:'MTc1NTc4ODAxMS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>







